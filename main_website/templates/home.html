{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
{% if user.is_authenticated %}
  Hi {{ user.email }}!
    <br>
    You are currently a {{ user.membership.membership_type }} has a balance of {{ user.balance }}
    <br>
    From {{ user.membership.start_time }} to {{ user.membership.end_time }}


  <p><a href="{% url 'logout' %}">logout</a></p>
  <form action="{% url 'membership' %}" method="post">
    {% csrf_token %}
       $80 BOIS FOR 1 YEAR CHEAP AF<br>
  <script
    src="https://checkout.stripe.com/checkout.js" class="stripe-button"
    data-key= 'pk_test_juvZMCiyaZxZjw2nulcmFC02'
    data-amount="8000"
    data-name="Share Shed"
    data-description="Membership Subscription"
    data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
    data-locale="auto"
    data-label="Pay 1 year Membership"
    data-currency="aud"
    data-allow-remember-me="false">
  </script>
    <!--<input type="submit" value="Add Membership" /> -->
  </form>



     <form id="myForm" action="//httpbin.org/post" method="POST">
  <input type="text" id="amountInDollars" />
  <input type="hidden" id="stripeToken" name="stripeToken" />
  <input type="hidden" id="stripeEmail" name="stripeEmail" />
  <input type="hidden" id="amountInCents" name="amountInCents" />
</form>

<script src="https://checkout.stripe.com/checkout.js"></script>
<button id="customButton">Top up</button>


<script>
  var handler = StripeCheckout.configure({
  key: 'pk_test_juvZMCiyaZxZjw2nulcmFC02',
  image: 'https://stripe.com/img/documentation/checkout/marketplace.png',
  token: function(token) {
    $("#stripeToken").val(token.id);
    $("#stripeEmail").val(token.email);
    $("#amountInCents").val(Math.floor($("#amountInDollars").val() * 100));
    $("#myForm").submit();
  }
});

$('#customButton').on('click', function(e) {
  var amountInCents = Math.floor($("#amountInDollars").val() * 100);
  var displayAmount = parseFloat(Math.floor($("#amountInDollars").val() * 100) / 100).toFixed(2);
  // Open Checkout with further options
  handler.open({
    name: 'Demo Site',
    description: 'Custom amount ($' + displayAmount + ')',
    amount: amountInCents,
       allowRememberMe:false
  });
  e.preventDefault();
});

// Close Checkout on page navigation
$(window).on('popstate', function() {
  handler.close();
});
</script>





{% else %}
  <p>You are not logged in</p>
  <a href="{% url 'login' %}">login</a> |
  <a href="{% url 'signup' %}">signup</a>
{% endif %}
{% endblock %}